```mermaid
classDiagram
    %% Main Application Class
    class MEMS {
        -Map~String, Ensemble~ ensembles
        -Map~String, Musician~ musicians
        -String currentEnsembleId
        -FactoryRegistry factoryRegistry
        -HistoryManager historyManager
        -Scanner scanner
        -List~CommandEntry~ availableCommands
        +main(String[] args)
        +run()
        +getEnsembles() Map~String, Ensemble~
        +getMusicians() Map~String, Musician~
        +getCurrentEnsembleId() String
        +getHistoryManager() HistoryManager
        +getFactoryRegistry() FactoryRegistry
    }

    %% Registry Classes
    class FactoryRegistry {
        -Map~String, EnsembleFactory~ ensembleFactories
        -Map~String, MusicianFactory~ musicianFactories
        -Map~String, CommandFactory~ commandFactories
        +registerEnsembleFactory(String, EnsembleFactory)
        +registerMusicianFactory(String, MusicianFactory)
        +registerCommandFactory(String, CommandFactory)
        +getEnsembleFactory(String) EnsembleFactory
        +getMusicianFactory(String) MusicianFactory
        +getCommandFactory(String) CommandFactory
    }

    class HistoryManager {
        -LinkedList~Command~ undoList
        -LinkedList~Command~ redoList
        +executeCommand(Command) boolean
        +undo() String
        +redo() String
        +getUndoList() List~String~
        +getRedoList() List~String~
    }

    class CommandEntry {
        -String commandKey
        -String description
        -CommandFactory factory
        +CommandEntry(String, String, CommandFactory)
        +matches(String) boolean
        +getDescription() String
        +createCommand() Command
    }

    %% Domain Classes
    class Ensemble {
        <<abstract>>
        -String ensembleID
        -String eName
        -AbstractList~Musician~ musicians
        +getEnsembleID() String
        +getName() String
        +setName(String)
        +addMusician(Musician)
        +dropMusician(Musician)
        +getMusicians() Iterator~Musician~
        +display()* void
    }

    class OrchestraEnsemble {
        +display() void
    }

    class JazzBandEnsemble {
        +display() void
    }

    class Musician {
        -String musicianID
        -String mName
        -int role
        +getMID() String
        +getRole() int
        +getName() String
        +setRole(int)
        +setName(String)
    }

    %% Memento Pattern Classes
    class EnsembleMemento {
        -String ensembleID
        -String eName
        -List~Musician~ musicians
        +getEID() String
        +getName() String
        +getMusicians() Iterator~Musician~
    }

    class EnsembleCaretaker {
        -Stack~EnsembleMemento~ mementoStack
        +createMemento(String, Iterator~Musician~, String)$ void
        +restoreMemento()$ void
        +popMemento()$ EnsembleMemento
    }

    class MusicianMemento {
        -String musicianID
        -String mName
        -int role
        -String roleName
        +getMID() String
        +getName() String
        +getRole() int
        +getRoleName() String
    }

    class MusicianCaretaker {
        -Stack~MusicianMemento~ mementoStack
        +createMemento(Musician, String)$ void
        +popMemento()$ MusicianMemento
    }

    %% Command Interface and Implementations
    class Command {
        <<interface>>
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class AddMusicianCommand {
        -String musicianId
        -String name
        -int role
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class DeleteMusicianCommand {
        -String musicianId
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class ModifyMusicianInstrumentCommand {
        -String musicianId
        -int newRole
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class CreateEnsembleCommand {
        -String ensembleId
        -String type
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class ChangeEnsembleNameCommand {
        -String newName
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class SwitchEnsembleCommand {
        -String ensembleId
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class ShowEnsembleCommand {
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class ListEnsemblesCommand {
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class ListHistoryCommand {
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class UndoCommand {
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class RedoCommand {
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    class ExitCommand {
        +readInput(Scanner) void
        +execute() boolean
        +undo() boolean
        +getDescription() String
    }

    %% Factory Interfaces
    class CommandFactory {
        <<interface>>
        +createCommand() Command
    }

    class EnsembleFactory {
        <<interface>>
        +createEnsemble(String) Ensemble
        +getEnsembleType() String
    }

    class MusicianFactory {
        <<interface>>
        +createMusician(String, String, int) Musician
        +isValidRole(int) boolean
        +getRoleName(int) String
        +getRolePrompt() String
    }

    %% Command Factory Implementations
    class AddMusicianCommandFactory {
        +createCommand() Command
    }

    class DeleteMusicianCommandFactory {
        +createCommand() Command
    }

    class ModifyMusicianInstrumentCommandFactory {
        +createCommand() Command
    }

    class CreateEnsembleCommandFactory {
        +createCommand() Command
    }

    class ChangeEnsembleNameCommandFactory {
        +createCommand() Command
    }

    class SwitchEnsembleCommandFactory {
        +createCommand() Command
    }

    class ShowEnsembleCommandFactory {
        +createCommand() Command
    }

    class ListEnsemblesCommandFactory {
        +createCommand() Command
    }

    class ListHistoryCommandFactory {
        +createCommand() Command
    }

    class UndoCommandFactory {
        +createCommand() Command
    }

    class RedoCommandFactory {
        +createCommand() Command
    }

    class ExitCommandFactory {
        +createCommand() Command
    }

    %% Ensemble Factory Implementations
    class OrchestraEnsembleFactory {
        +createEnsemble(String) Ensemble
        +getEnsembleType() String
    }

    class JazzBandEnsembleFactory {
        +createEnsemble(String) Ensemble
        +getEnsembleType() String
    }

    %% Musician Factory Implementations
    class OrchestraMusicianFactory {
        -int VIOLINIST_ROLE
        -int CELLIST_ROLE
        +createMusician(String, String, int) Musician
        +isValidRole(int) boolean
        +getRoleName(int) String
        +getRolePrompt() String
    }

    class JazzBandMusicianFactory {
        -int PIANIST_ROLE
        -int SAXOPHONIST_ROLE
        -int DRUMMER_ROLE
        +createMusician(String, String, int) Musician
        +isValidRole(int) boolean
        +getRoleName(int) String
        +getRolePrompt() String
    }

    %% Relationships
    %% MEMS aggregation/composition
    MEMS *-- FactoryRegistry : contains
    MEMS *-- HistoryManager : contains
    MEMS o-- Ensemble : manages
    MEMS o-- Musician : manages
    MEMS o-- CommandEntry : contains

    %% Ensemble hierarchy
    Ensemble <|-- OrchestraEnsemble : extends
    Ensemble <|-- JazzBandEnsemble : extends
    Ensemble o-- Musician : contains

    %% Command pattern
    Command <|.. AddMusicianCommand : implements
    Command <|.. DeleteMusicianCommand : implements
    Command <|.. ModifyMusicianInstrumentCommand : implements
    Command <|.. CreateEnsembleCommand : implements
    Command <|.. ChangeEnsembleNameCommand : implements
    Command <|.. SwitchEnsembleCommand : implements
    Command <|.. ShowEnsembleCommand : implements
    Command <|.. ListEnsemblesCommand : implements
    Command <|.. ListHistoryCommand : implements
    Command <|.. UndoCommand : implements
    Command <|.. RedoCommand : implements
    Command <|.. ExitCommand : implements

    %% Factory pattern - Command Factories
    CommandFactory <|.. AddMusicianCommandFactory : implements
    CommandFactory <|.. DeleteMusicianCommandFactory : implements
    CommandFactory <|.. ModifyMusicianInstrumentCommandFactory : implements
    CommandFactory <|.. CreateEnsembleCommandFactory : implements
    CommandFactory <|.. ChangeEnsembleNameCommandFactory : implements
    CommandFactory <|.. SwitchEnsembleCommandFactory : implements
    CommandFactory <|.. ShowEnsembleCommandFactory : implements
    CommandFactory <|.. ListEnsemblesCommandFactory : implements
    CommandFactory <|.. ListHistoryCommandFactory : implements
    CommandFactory <|.. UndoCommandFactory : implements
    CommandFactory <|.. RedoCommandFactory : implements
    CommandFactory <|.. ExitCommandFactory : implements

    %% Factory pattern - Ensemble Factories
    EnsembleFactory <|.. OrchestraEnsembleFactory : implements
    EnsembleFactory <|.. JazzBandEnsembleFactory : implements

    %% Factory pattern - Musician Factories
    MusicianFactory <|.. OrchestraMusicianFactory : implements
    MusicianFactory <|.. JazzBandMusicianFactory : implements

    %% Factory Registry relationships
    FactoryRegistry o-- CommandFactory : registers
    FactoryRegistry o-- EnsembleFactory : registers
    FactoryRegistry o-- MusicianFactory : registers

    %% CommandEntry relationships
    CommandEntry --> CommandFactory : uses
    CommandEntry --> Command : creates

    %% History Manager relationships
    HistoryManager o-- Command : manages

    %% Memento pattern relationships
    EnsembleCaretaker o-- EnsembleMemento : stores
    MusicianCaretaker o-- MusicianMemento : stores
    Ensemble ..> EnsembleMemento : creates
    Musician ..> MusicianMemento : creates

    %% Factory creates products
    CommandFactory ..> Command : creates
    EnsembleFactory ..> Ensemble : creates
    MusicianFactory ..> Musician : creates
    OrchestraEnsembleFactory ..> OrchestraEnsemble : creates
    JazzBandEnsembleFactory ..> JazzBandEnsemble : creates
    OrchestraMusicianFactory ..> Musician : creates
    JazzBandMusicianFactory ..> Musician : creates
```
